{# Tables Component - Common table elements and patterns #}

{# Data Table Component #}
{% macro data_table(id, columns, data=None, sortable=true, selectable=true, classes="") %}
<div class="table-responsive">
    <table class="table table-striped {{ classes }}" id="{{ id }}">
        <thead>
            <tr>
                {% if selectable %}
                <th width="40">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="select-all-{{ id }}">
                        <label class="form-check-label" for="select-all-{{ id }}"></label>
                    </div>
                </th>
                {% endif %}
                {% for column in columns %}
                <th class="{{ 'sortable' if sortable and column.sortable else '' }}" 
                    data-column="{{ column.key }}" 
                    data-type="{{ column.type if column.type else 'text' }}">
                    {{ column.label }}
                    {% if sortable and column.sortable %}
                    <i class="fas fa-sort text-muted"></i>
                    {% endif %}
                </th>
                {% endfor %}
                <th width="120">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% if data %}
                {% for row in data %}
                <tr data-id="{{ row.id }}">
                    {% if selectable %}
                    <td>
                        <div class="form-check">
                            <input class="form-check-input row-selector" type="checkbox" 
                                   value="{{ row.id }}" data-id="{{ row.id }}">
                        </div>
                    </td>
                    {% endif %}
                    {% for column in columns %}
                    <td class="{{ column.classes if column.classes else '' }}">
                        {% if column.template %}
                            {% include column.template with context %}
                        {% else %}
                            {{ row[column.key] }}
                        {% endif %}
                    </td>
                    {% endfor %}
                    <td>
                        {% block row_actions scoped %}{% endblock %}
                    </td>
                </tr>
                {% endfor %}
            {% else %}
                <tr>
                    <td colspan="{{ columns|length + (1 if selectable else 0) + 1 }}" class="text-center text-muted">
                        No data available
                    </td>
                </tr>
            {% endif %}
        </tbody>
    </table>
</div>
{% endmacro %}

{# Bulk Actions Toolbar Component #}
{% macro bulk_actions_toolbar(id, actions=None) %}
<div id="bulk-actions-{{ id }}" class="alert alert-info" style="display: none;">
    <div class="row align-items-center">
        <div class="col">
            <strong><span id="selected-count-{{ id }}">0</span> item(s) selected</strong>
        </div>
        <div class="col-auto">
            <div class="btn-group btn-group-sm">
                {% if actions %}
                    {% for action in actions %}
                    <button type="button" class="btn btn-outline-{{ action.classes }}" 
                            id="bulk-{{ action.id }}-{{ id }}">
                        <i class="fas fa-{{ action.icon }} me-1"></i>{{ action.text }}
                    </button>
                    {% endfor %}
                {% else %}
                    <button type="button" class="btn btn-outline-primary" id="bulk-export-{{ id }}">
                        <i class="fas fa-download me-1"></i>Export Selected
                    </button>
                    <button type="button" class="btn btn-outline-danger" id="bulk-delete-{{ id }}">
                        <i class="fas fa-trash me-1"></i>Delete Selected
                    </button>
                {% endif %}
                <button type="button" class="btn btn-outline-secondary" id="clear-selection-{{ id }}">
                    <i class="fas fa-times me-1"></i>Clear Selection
                </button>
            </div>
        </div>
    </div>
</div>
{% endmacro %}

{# Table Header Component #}
{% macro table_header(title, subtitle="", actions=None, filters=None) %}
<div class="card">
    <div class="card-header">
        <div class="row align-items-center">
            <div class="col-md-4">
                <h5 class="mb-0">
                    <i class="fas fa-{{ 'box' if 'product' in title.lower() else 'warehouse' if 'warehouse' in title.lower() else 'list' }} me-2"></i>
                    {{ title }}
                </h5>
                {% if subtitle %}
                <small class="text-muted">{{ subtitle }}</small>
                {% endif %}
            </div>
            <div class="col-md-8">
                {% if filters %}
                <div class="row g-2">
                    {% for filter in filters %}
                    <div class="col-md-{{ filter.width if filter.width else '3' }}">
                        {% if filter.type == 'search' %}
                            {{ search_input(filter.id, filter.placeholder, filter.classes, filter.scan_button) }}
                        {% elif filter.type == 'select' %}
                            {{ filter_select(filter.id, filter.options, filter.placeholder, filter.classes) }}
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
                {% if actions %}
                <div class="btn-toolbar mb-2 mb-md-0">
                    <div class="btn-group me-2">
                        {% for action in actions %}
                        <button type="button" class="btn btn-sm btn-{{ action.classes }} {{ action.id }}" 
                                data-type="{{ action.data_type if action.data_type else '' }}">
                            <i class="fas fa-{{ action.icon }}"></i> {{ action.text }}
                        </button>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    <div class="card-body">
        {% block table_content %}{% endblock %}
    </div>
</div>
{% endmacro %}

{# Status Badge Component #}
{% macro status_badge(status, text=None, classes="") %}
{% set status_map = {
    'active': 'success',
    'inactive': 'secondary',
    'pending': 'warning',
    'completed': 'success',
    'cancelled': 'danger',
    'low': 'warning',
    'out': 'danger',
    'normal': 'success'
} %}
<span class="badge bg-{{ status_map.get(status.lower(), 'secondary') }} status-badge {{ classes }}">
    {{ text if text else status|title }}
</span>
{% endmacro %}

{# Pagination Component #}
{% macro pagination(id, current_page, total_pages, base_url="") %}
{% if total_pages > 1 %}
<nav aria-label="Page navigation">
    <ul class="pagination justify-content-center" id="pagination-{{ id }}">
        <li class="page-item {{ 'disabled' if current_page == 1 }}">
            <a class="page-link" href="{{ base_url }}?page={{ current_page - 1 }}" 
               {{ 'tabindex="-1" aria-disabled="true"' if current_page == 1 }}>
                Previous
            </a>
        </li>
        
        {% for page in range(1, total_pages + 1) %}
            {% if page == 1 or page == total_pages or (page >= current_page - 2 and page <= current_page + 2) %}
            <li class="page-item {{ 'active' if page == current_page }}">
                <a class="page-link" href="{{ base_url }}?page={{ page }}">{{ page }}</a>
            </li>
            {% elif page == current_page - 3 or page == current_page + 3 %}
            <li class="page-item disabled">
                <span class="page-link">...</span>
            </li>
            {% endif %}
        {% endfor %}
        
        <li class="page-item {{ 'disabled' if current_page == total_pages }}">
            <a class="page-link" href="{{ base_url }}?page={{ current_page + 1 }}"
               {{ 'tabindex="-1" aria-disabled="true"' if current_page == total_pages }}>
                Next
            </a>
        </li>
    </ul>
</nav>
{% endif %}
{% endmacro %}
